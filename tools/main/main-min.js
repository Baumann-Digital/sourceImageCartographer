de.edirom.server.main.Action=Class.create({initialize:function(){}});de.edirom.server.main.SaveAction=Class.create(de.edirom.server.main.Action,{initialize:function($super,b,c,a){$super();this.module=b;this.toolbarItem=new de.edirom.server.main.toolbar.Save(c,this);a.addListener(function(d){this.toolbarItem.setActive(d.unsavedCommands())}.bind(this))},doSave:function(){this.module.doSave()}});de.edirom.server.main.UndoAction=Class.create(de.edirom.server.main.Action,{initialize:function($super,b,c,a){$super();this.module=b;this.toolbarItem=new de.edirom.server.main.toolbar.Undo(c,this);a.addListener(function(d){this.toolbarItem.setActive(d.checkUndo())}.bind(this))},doUndo:function(){this.module.doUndo()}});de.edirom.server.main.RedoAction=Class.create(de.edirom.server.main.Action,{initialize:function($super,b,c,a){$super();this.module=b;this.toolbarItem=new de.edirom.server.main.toolbar.Redo(c,this);a.addListener(function(d){this.toolbarItem.setActive(d.checkRedo())}.bind(this))},doRedo:function(){this.module.doRedo()}});de.edirom.server.main.DropDownAction=Class.create(de.edirom.server.main.Action,{initialize:function($super,b,c,a,d){$super();this.module=b;this.toolbarItem=new de.edirom.server.main.toolbar.dropDown(c,this,d,a);a.addListener(function(e){this.toolbarItem.setActive(e.checkCommandCount())}.bind(this))},doDropDown:function(){var a=this.module.doDropDown();return a}});de.edirom.server.main.AddObjectCommand=Class.create({type:"AddObjectCommand",initialize:function(b,c,a){this.subject=b;this.list=c;this.object=a;this.undone=false},undo:function(){if(this.object.id){this.subject.removeObject(this.list,this.object.id)}else{this.subject.removeObject(this.list,this.object)}},redo:function(){this.subject.addObject(this.list,this.object)},getXQueryUpdate:function(){return this.subject.getXQueryUpdateList("add",this.list,this.object)},getType:function(){return this.type},getUndone:function(){return this.undone},setUndone:function(a){this.undone=a}});de.edirom.server.main.ChangeFieldCommand=Class.create({type:"ChangeFieldCommand",initialize:function(a,c,b,d){this.object=a;this.field=c;this.newValue=b;this.title=d;this.oldValue=a.getField(c);this.undone=false},undo:function(){this.object.setField(this.field,this.oldValue);this.undone=true},redo:function(){this.object.setField(this.field,this.newValue);this.undone=false;this.name=this.field+": "+this.oldValue},getXQueryUpdate:function(){if(this.undone){if(isNaN(this.oldValue)){return this.object.getXQueryUpdate(this.field,this.oldValue.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))}else{return this.object.getXQueryUpdate(this.field,this.oldValue)}}else{if(isNaN(this.newValue)){return this.object.getXQueryUpdate(this.field,this.newValue.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))}else{return this.object.getXQueryUpdate(this.field,this.newValue)}}},getType:function(){if(this.title==undefined){return this.type}return this.title},getOldValue:function(){return this.oldValue},getUndone:function(){return this.undone},setUndone:function(a){this.undone=a}});de.edirom.server.main.CommandController=Class.create({listeners:new Array(),initialize:function(){this.stack=new Array();this.saved=-1;this.pointer=-1;this.commandCount=0;this.isThereUndo=false},addListener:function(a){this.listeners.push(a)},removeListener:function(a){this.listeners=this.listeners.without(a)},updateListeners:function(a,b){this.listeners.each(function(c){c(this,a,b)}.bind(this))},addCommand:function(a){if((this.pointer==-1)&&(this.saved==-1)||((this.saved==0)&&(this.pointer==-1))){this.stack=new Array();this.saved=-1;this.pointer=-1;this.commandCount=0;this.isThereUndo=false;this.stack.push(a)}else{this.stack.push(a)}a.redo();if(a.getType()!="UndoCommand"){this.pointer++;this.commandCount++;this.updateListeners("redo",a)}},undoCommand:function(){this.addCommand(new de.edirom.server.main.UndoCommand(this.stack,this.pointer));this.stack[this.pointer].setUndone(true);this.pointer--;this.isThereUndo=true;this.updateListeners("undo",this.stack[this.pointer+1])},redoCommand:function(){var a=this.stack.length-1;this.stack[a].undo();this.stack[a].setUndone(false);this.stack[a].setCommandUndone(false);this.stack.splice(a,1);this.pointer++;if(this.pointer==this.stack.length-1){this.isThereUndo=false}this.updateListeners("redo",this.stack[this.pointer])},refresh:function(){var b=this.stack.length;var a=0;for(var a;a<b;a++){if(this.stack[a].getUndone()==true){this.stack.splice(a,1);b--;a=0}}},getXQueryUpdates:function(){var a="";if(this.undoOrRedo()){for(var b=this.saved+1;b<=this.pointer;b++){a+=this.stack[b].getXQueryUpdate()+(b==this.pointer?"":",")}}else{for(var b=this.stack.length-1;b>=this.pointer;b--){if(this.stack[b].getType()!="UndoCommand"){a+=this.stack[b].getXQueryUpdate()+(((b==0)||(b==this.pointer))?"":",")}if(b==0){break}}}this.saved=this.pointer;this.refresh();this.updateListeners();this.isThereUndo=false;return a},unsavedCommands:function(){if(this.pointer==this.saved){return false}return true},checkUndo:function(){if(this.saved==this.pointer){return false}return true},checkRedo:function(){if(this.isThereUndo){return true}return false},undoOrRedo:function(){return true},getCommandList:function(){var c="";var a=7;if(this.commandCount<=8||(this.pointer==this.stack.length-1)){for(var b=this.stack.length-1;b>this.saved;b--){if((this.stack[b].type!="UndoCommand")&&(a>=0)){if(b==this.position){c+='<div id="Command_'+b+'" class="toolbar_dropdown_command active">'+this.stack[b].getType()+"</div>"}else{if(((this.id==b)&&(this.id!=0))||((this.id==0)&&(b==0))){c+='<div id="Command_'+b+'" class="toolbar_dropdown_command active">'+this.stack[b].getType()+"</div>"}else{c+='<div id="Command_'+b+'" class="toolbar_dropdown_command">'+this.stack[b].getType()+"</div>"}}a--}}}else{var b=this.pointer;var f=b+4;var d=b-3;if(b<3){switch(b){case 2:f=b+5;d=b-2;break;case 1:f=b+6;d=b-1;break;case 0:f=b+7;d=b;break;case -1:f=b+8;d=b+1;break}}var e=this.position-this.pointer;if(e<7){switch(e){case 6:f=b+3;d=b-4;break;case 4:f=b+2;d=b-5;break;case 2:f=b+1;d=b-6;break;case 0:f=b;d=b-7;break}}for(f;f>=d;f--){if((this.stack[f].type!="UndoCommand")){if(f==this.position){c+='<div id="Command_'+b+'" class="toolbar_dropdown_command active">'+this.stack[f].getType()+"</div>"}else{if(((this.id==f)&&(this.id!=0))||((this.id==0)&&(f==0))){c+='<div id="Command_'+b+'" class="toolbar_dropdown_command active">'+this.stack[f].getType()+"</div>"}else{c+='<div id="Command_'+b+'" class="toolbar_dropdown_command">'+this.stack[f].getType()+"</div>"}}}}}return c},createMultiUndo:function(b){this.id=b;var a=this.pointer;if(b<=a){while(a>b){this.undoCommand();a--}}else{while(a<b){this.redoCommand();a++}}},checkCommandCount:function(){if(this.commandCount>=0){return true}return false},});de.edirom.server.main.Content=Class.create({initialize:function(a,b){this.view=a;this.loaded=false;this.visible=false;this.id=b;$(a.id).insert({bottom:'<div class="ediromDetailContent" id="'+this.id+'" />'});this.elements=new Array()},load:function(){this.loaded=true},isLoaded:function(){return this.loaded},setUnloaded:function(){this.loaded=false;$(this.id).update()},setVisible:function(a){this.visible=a;if(a){$(this.id).show();this.load()}else{$(this.id).hide()}},isActive:function(){return this.visible},getKey:function(){return this.id}});de.edirom.server.main.DigilibViewer=Class.create({OVERLAP:12,initialize:function(b,d,c,a){this.facsimileViewer=b;this.instance=Raphael(d,c,a);this.svgDoc=$(d).getElementsByTagNameNS("http://www.w3.org/2000/svg","svg")[0];this.svgDoc.setAttribute("viewBox","0 0 "+c+" "+a);this.images=new Array()},buildInitialStructure:function(){for(var a=this.facsimileViewer.getMaxKey();a>=0;a--){this.images[a]=new Array();for(var b=0;b<this.facsimileViewer.getNumCols(a);b++){this.images[a][b]=new Array();for(var c=0;c<this.facsimileViewer.getNumRows(a);c++){this.images[a][b][c]=this.instance.image("",b*this.facsimileViewer.TILE_SIZE*Math.pow(2,a),c*this.facsimileViewer.TILE_SIZE*Math.pow(2,a))}}}},loadImages:function(){var a=this.facsimileViewer.TILE_SIZE;var f=this.facsimileViewer.getKey();var d=this.facsimileViewer.getContainerWidth();var g=this.facsimileViewer.getContainerHeight();var j=this.facsimileViewer.getOffX();var i=this.facsimileViewer.getOffY();var l=this.facsimileViewer.getZoom();var e=0;var h=0;if(j<0){h=Math.floor(Math.round((j*-1)/l/Math.pow(2,f))/a)}if(i<0){e=Math.floor(Math.round((i*-1)/l/Math.pow(2,f))/a)}var c=Math.floor(((d-j)/Math.pow(2,f))/l/a);var n=Math.floor(((g-i)/Math.pow(2,f))/l/a);if(h<0){h=0}if(e<0){e=0}if(c>this.facsimileViewer.getNumCols(f)-1){c=this.facsimileViewer.getNumCols(f)-1}if(n>this.facsimileViewer.getNumRows(f)-1){n=this.facsimileViewer.getNumRows(f)-1}for(var b=h;b<=c;b++){for(var m=e;m<=n;m++){this.loadImage(b,m,f)}}},loadImage:function(f,p,h){if(this.images[h][f][p].attrs.src!="about:blank"){return}var e=this.facsimileViewer.TILE_SIZE;var d=this.facsimileViewer.getFacsimileWidth(h);var n=this.facsimileViewer.getFacsimileHeight(h);var a=e;var m=e;var i=f*(e/d);var g=p*(e/n);if(f==this.facsimileViewer.getNumCols(h)-1){a=d%e;if(a==0){a=e}j=a/d}else{if(f==this.facsimileViewer.getNumCols(h)-2){var c=d%e;c=(c==0?e:c);a+=Math.min(c,this.OVERLAP)}else{a+=this.OVERLAP}}if(p==this.facsimileViewer.getNumRows(h)-1){m=n%e;if(m==0){m=e}b=m/n}else{if(p==this.facsimileViewer.getNumRows(h)-2){var l=n%e;l=(l==0?e:l);m+=Math.min(l,this.OVERLAP)}else{m+=this.OVERLAP}}var j=a/d;var b=m/n;var o;if(this.key!=0){o="/digilib/Scaler/"+this.facsimileViewer.getFacsimilePath()+"?dw="+a+"&amp;dh="+m+"&amp;wx="+i+"&amp;wy="+g+"&amp;ww="+j+"&amp;wh="+b+"&amp;mo=fit&amp;key="+h}else{o="/digilib/Scaler/"+this.facsimileViewer.getFacsimilePath()+"?dw="+a+"&amp;dh="+m+"&amp;wx="+i+"&amp;wy="+g+"&amp;mo=clip&amp;key="+h}this.images[h][f][p].attr({src:o,width:Math.round(a*Math.pow(2,h)),height:Math.round(m*Math.pow(2,h))})},setSize:function(b,a){this.svgDoc.setAttribute("width",b);this.svgDoc.setAttribute("height",a)},setPosition:function(a,b){this.svgDoc.setAttribute("style","top:"+b+"px; left:"+a+"px; position: absolute;")}});de.edirom.server.main.DropDown=Class.create({initialize:function(){this.timeout=1500;this.closeTimer=null;this.item="";document.observe("click",this.menuClose.bindAsEventListener(this))},menuOpen:function(b){this.menuCancelCloseTime();var a=document.getElementById(b);if(a){a.style.visibility="hidden"}a.style.visibility="visible"},menuClose:function(){var a=document.getElementById("menu");if(a){a.style.visibility="hidden"}},menuCloseTime:function(a){this.closeTimer=window.setTimeout(this.menuClose.bind(this),this.timeout)},menuCancelCloseTime:function(){if(this.closeTimer){window.clearTimeout(this.closeTimer);this.closeTimer=null}},checkVisibility:function(){var a=document.getElementById("menu");if(a.style.visibility=="visible"){return true}return false}});de.edirom.server.main.FacsimileViewer=Class.create({TILE_SIZE:512,ZOOM_MIN:0.05,ZOOM_MAX:4,zoom:-1,offX:-1,offY:-1,mouseOffX:0,mouseOffY:0,posX:0,posY:0,key:1,maxKey:-1,initialize:function(a,b){this.id="facsimileView_"+(new Date).getTime();this.facsimiles=b;this.container=a;a.insert({bottom:'<div id="canvas_'+this.id+'" style="position:absolute; top:0px; left:0px; bottom:0px; right:0px; -moz-user-select:none;"> </div>'});a.insert({bottom:'<div id="eventHandler_'+this.id+'" style="position:absolute; top:0px; left:0px; bottom:0px; right:0px; -moz-user-select:none;"> </div>'});this.zoomListeners=new Array();this.offsetListeners=new Array();this.mouseDownListeners=new Array();this.addListeners()},addListeners:function(){this.handleMouseDownFunc=this.handleMouseDown.bindAsEventListener(this);Event.observe($("eventHandler_"+this.id),"mousedown",this.handleMouseDownFunc);this.handleImageZoomFunc=this.handleImageZoom.bindAsEventListener(this);Event.observe($("eventHandler_"+this.id),"mousewheel",this.handleImageZoomFunc);Event.observe($("eventHandler_"+this.id),"DOMMouseScroll",this.handleImageZoomFunc)},loadFacsimile:function(b){this.readFacsimile(b);this.startULX=0;this.startULY=0;this.startLRX=this.facsimileWidth[0];this.startLRY=this.facsimileHeight[0];var a=$("canvas_"+this.id).getElementsByTagNameNS("http://www.w3.org/2000/svg","svg")[0];if(a){$("canvas_"+this.id).removeChild(a)}this.digilib=new de.edirom.server.main.DigilibViewer(this,"canvas_"+this.id,this.facsimileWidth[0],this.facsimileHeight[0]);this.digilib.buildInitialStructure();this.resetFacsimileView();this.digilib.loadImages()},readFacsimile:function(c){this.facsimileId=c;var a=this.facsimiles.get(c);this.facsimilePath=a.getPath();this.facsimileWidth=new Array();this.facsimileHeight=new Array();this.facsimileWidth[0]=Number(a.getWidth());this.facsimileHeight[0]=Number(a.getHeight());for(var b=1;b<=this.getMaxKey();b++){this.facsimileWidth[b]=Math.round(a.getWidth()/Math.pow(2,b));this.facsimileHeight[b]=Math.round(a.getHeight()/Math.pow(2,b))}},loadRect:function(b,a,d,c){this.startULX=b;this.startULY=a;this.startLRX=d;this.startLRY=c;this.resetFacsimileView()},resetFacsimileView:function(){var d=this.container.getWidth();var f=this.container.getHeight();var h=this.startLRX-this.startULX;var b=this.startLRY-this.startULY;var c;var a;var e=0;var g=0;if((d/h)>(f/b)){this.setZoom(f/b);a=this.startULY*this.zoom;c=this.startULX*this.zoom;e=Math.round((d-(h*this.zoom))/2)}else{this.setZoom(d/h);a=this.startULY*this.zoom;c=this.startULX*this.zoom;g=Math.round((f-(b*this.zoom))/2)}this.setOffset(((c*-1)+e),((a*-1)+g));this.digilib.loadImages()},getFacsimileId:function(){return this.facsimileId},getFacsimileWidth:function(a){return this.facsimileWidth[a]},getFacsimileHeight:function(a){return this.facsimileHeight[a]},getFacsimilePath:function(){return this.facsimilePath},getMaxKey:function(){if(this.maxKey==-1){this.maxKey=Math.max(this.getMaxKeyInt(Number(this.facsimileWidth[0])/this.TILE_SIZE),this.getMaxKeyInt(Number(this.facsimileHeight[0])/this.TILE_SIZE))}return this.maxKey},getMaxKeyInt:function(a){if(a<=1){return 0}if(a<=2){return 1}if(a<=4){return 2}if(a<=8){return 3}if(a<=16){return 4}return 5},getNumCols:function(a){return Math.ceil(this.facsimileWidth[a]/this.TILE_SIZE)},getNumRows:function(a){return Math.ceil(this.facsimileHeight[a]/this.TILE_SIZE)},nextFacsimile:function(){var a=this.facsimiles.getNext(this.facsimileId);if(a!=null){this.loadFacsimile(a.id)}return a},prevFacsimile:function(){var a=this.facsimiles.getPrevious(this.facsimileId);if(a!=null){this.loadFacsimile(a.id)}return a},firstFacsimile:function(){var a=this.facsimiles.getFirst();if(a!=null){this.loadFacsimile(a.id)}return a},showFacsimile:function(b){var a=this.facsimiles.get(b);if(a!=null){this.loadFacsimile(a.id)}return a},hasNextFacsimile:function(){var a=this.facsimiles.getNext(this.facsimileId);return a!=null},hasPrevFacsimile:function(){var a=this.facsimiles.getPrevious(this.facsimileId);return a!=null},handleMouseDown:function(a){this.mouseOffX=this.offX;this.mouseOffY=this.offY;this.posX=a.screenX;this.posY=a.screenY;if(!a.shiftKey){this.mouseMoveHandle=this.handleMouseMove.bindAsEventListener(this);this.mouseUpHandle=this.handleMouseUp.bindAsEventListener(this);Event.observe(window.document,"mousemove",this.mouseMoveHandle);Event.observe(window.document,"mouseup",this.mouseUpHandle)}this.mouseDownListeners.each(function(b){b(a)})},handleMouseMove:function(a){this.setOffset(this.mouseOffX-(this.posX-a.screenX),this.mouseOffY-(this.posY-a.screenY));this.digilib.loadImages()},handleMouseUp:function(a){Event.stopObserving(window.document,"mousemove",this.mouseMoveHandle);Event.stopObserving(window.document,"mouseup",this.mouseUpHandle);this.setOffset(this.mouseOffX-(this.posX-a.screenX),this.mouseOffY-(this.posY-a.screenY));this.digilib.loadImages()},handleImageZoom:function(b){this.lastZoomAction=new Date().getTime();var a=this.lastZoomAction;window.setTimeout(this.handleImageZoomThread.bind(this,b,a),"10")},handleImageZoomThread:function(g,a){if(a<this.lastZoomAction){return}var k=this.zoom;var i=1;if(this.zoom<0.5){i=1}else{if(this.zoom<1){i=1.5}else{if(this.zoom<2){i=1.8}else{i=2.2}}}var f=Math.round(this.zoom*100+(Event.wheel(g)*i))/100;this.setZoom(f);var d=de.edirom.server.main.getPositionOnPage($("canvas_"+this.id));var j=g.pageX-d[0];var h=g.pageY-d[1];var c=Math.round((j-this.offX)/k);var b=Math.round((h-this.offY)/k);this.setOffset(j-Math.round(c*this.zoom),h-Math.round(b*this.zoom));this.digilib.loadImages()},setOffset:function(a,b){this.offX=a;this.offY=b;this.digilib.setPosition(this.offX,this.offY);this.offsetListeners.each(function(c){c(this.offX,this.offY)}.bind(this))},setZoom:function(a){if(a>this.ZOOM_MAX){this.zoom=this.ZOOM_MAX}else{if(a<this.ZOOM_MIN){this.zoom=this.ZOOM_MIN}else{this.zoom=a}}this.getKeyForZoom();if(typeof this.digilib!="undefined"){this.digilib.setSize(Math.round(this.getFacsimileWidth(0)*this.getZoom()),Math.round(this.getFacsimileHeight(0)*this.getZoom()))}this.zoomListeners.each(function(b){b(this.zoom)}.bind(this))},getZoom:function(){return this.zoom},getOffX:function(){return this.offX},getOffY:function(){return this.offY},updateZoom:function(a,b){var c=this.zoom;if(isNaN(a)){this.setZoom(c)}else{if(typeof b!="undefined"){a=Number(a)+(Number(b)*10)}this.setZoom(a/100);var e=Math.round(((this.getContainerWidth()/2)-this.offX)/c);var d=Math.round(((this.getContainerHeight()/2)-this.offY)/c);this.setOffset(Math.round((this.getContainerWidth()/2)-(e*this.zoom)),Math.round((this.getContainerHeight()/2)-(d*this.zoom)));this.digilib.loadImages()}},getContainerWidth:function(){return $("eventHandler_"+this.id).getWidth()},getContainerHeight:function(){return $("eventHandler_"+this.id).getHeight()},getKeyForZoom:function(){this.key=this.maxKey;for(var a=this.maxKey;a>0;){if(1/Math.pow(2,a)>this.zoom){break}a=a-1;this.key=a}},getKey:function(){return this.key},addZoomListener:function(a){this.zoomListeners.push(a)},addOffsetListener:function(a){this.offsetListeners.push(a)},addMouseDownListener:function(a){this.mouseDownListeners.push(a)},destroy:function(){Event.stopObserving($("eventHandler_"+this.id),"mousedown",this.handleMouseDownFunc);Event.stopObserving($("eventHandler_"+this.id),"mousewheel",this.handleImageZoomFunc);Event.stopObserving($("eventHandler_"+this.id),"DOMMouseScroll",this.handleImageZoomFunc);this.container.removeChild($("canvas_"+this.id));this.container.removeChild($("eventHandler_"+this.id))}});de.edirom.server.main.GroupCommand=Class.create({type:"GroupCommand",initialize:function(){this.list=new Array();this.undone=false},addGroupCommand:function(a){this.list.push(a)},undo:function(){for(var a=this.list.length-1;a>=0;a--){this.list[a].undo()}},redo:function(){for(var a=0;a<this.list.length;a++){this.list[a].redo()}},getXQueryUpdate:function(){var b="";for(var a=0;a<this.list.length;a++){b+=this.list[a].getXQueryUpdate()+(a==this.list.length-1?"":",")}return b},getLength:function(){return this.list.length},getUndone:function(){return this.undone},setUndone:function(a){this.undone=a},getType:function(){return this.type}});de.edirom.server.main.Indicator=Class.create({initialize:function(a){this.hashMap=new de.edirom.server.main.LinkedHashMap();this.index=-1;this.viewId=a;this.view=$(this.viewId);this.active=false;this.view.insert({bottom:'<div id="indicator" style="display:block">                                       <div id="indicator_icon" class="inactive"></div>                                       <div id="indicator_text" class="inactive"></div>                                   </div>'});this.getJob()},refresh:function(){this.getJob()},addJob:function(b,a){this.hashMap.pushElement(b,a);this.index++;this.refresh()},setJobDescription:function(b,a){this.hashMap.setValue(b,a);this.refresh()},jobFinished:function(a){$("indicator_text").update(this.hashMap.get(a)+" complete");this.hashMap.remove(a);this.index--;window.setTimeout(this.refresh.bindAsEventListener(this),1000)},hide:function(){$("indicator").style.display="none"},show:function(){$("indicator").style.display="block"},getJob:function(){if(this.hashMap.length==0){this.active=false;$("indicator_text").update("")}else{var a=this.hashMap.keys();this.active=true;$("indicator_text").update(this.hashMap.get(a[this.index]))}this.setActive(this.active)},setActive:function(a){if(a){$("indicator_icon").removeClassName("inactive");$("indicator_text").removeClassName("inactive");$("indicator_icon").addClassName("active");$("indicator_text").addClassName("active")}else{$("indicator_text").removeClassName("active");$("indicator_icon").removeClassName("active");$("indicator_text").addClassName("inactive");$("indicator_icon").addClassName("inactive")}}});de.edirom.server.main.LinkedHashMap=Class.create();Object.extend(de.edirom.server.main.LinkedHashMap.prototype,Enumerable);Object.extend(de.edirom.server.main.LinkedHashMap.prototype,{initialize:function(a){this.hash=new Hash();this.length=0;this.startID;this.endID;if(typeof(a)!="undefined"){$A(a).each(function(b){this.pushElement(b.id,b)}.bind(this))}},_each:function(c){var a=this.startID;for(var b=this.length;b>0;b--){c(this.get(a));a=this.hash.get(a)._next}},pushElement:function(a,e){var d;var c=null;if(this.length==0){d=null;this.startID=a}else{d=this.endID;this.hash.get(this.endID)._next=a}this.endID=a;var b=new Object();b._previous=d;b.value=e;b._next=c;this.hash.set(a,b);this.length++},unshiftElement:function(a,e){var d=null;var c;if(this.length==0){c=null;this.endID=a}else{c=this.startID;this.hash.get(this.startID)._previous=a}this.startID=a;var b=new Object();b._previous=d;b.value=e;b._next=c;this.hash.set(a,b);this.length++},insert:function(e,a,d){if(e==this.endID){this.pushElement(a,d)}else{if(e==null){this.unshiftElement(a,d)}else{var c=this.hash.get(e)._next;this.hash.get(e)._next=a;this.hash.get(c)._previous=a;var b=new Object();b._previous=e;b.value=d;b._next=c;this.hash.set(a,b);this.length++}}},popElement:function(){if(this.length<=0){return false}var a=this.endID;if(this.length>1){this.endID=this.hash.get(this.endID)._previous}else{if(this.length==1){this.endID=null;this.startID=null}}this.hash.unset(a);this.length--},shiftElement:function(){if(this.length<=0){return false}var a=this.startID;if(this.length>1){this.startID=this.hash.get(this.startID)._next}else{if(this.length==1){this.startID=null;this.endID=null}}this.hash.unset(a);this.length--},remove:function(a){if(!this.containsKey(a)){return false}if(a==this.startID){this.shiftElement()}else{if(a==this.endID){this.popElement()}else{var b=this.hash.get(a)._next;var c=this.hash.get(a)._previous;this.hash.get(b)._previous=c;this.hash.get(c)._next=b;this.hash.unset(a);this.length--}}},containsKey:function(a){return(this.hash.keys().indexOf(a)!=-1)},get:function(a){if(this.containsKey(a)){return this.hash.get(a).value}else{return false}},getNext:function(a){if(!this.containsKey(a)){return false}else{if(a==this.endID){return null}else{return this.hash.get(this.hash.get(a)._next).value}}},getPrevious:function(a){if(!this.containsKey(a)){return false}else{if(a==this.startID){return null}else{return this.hash.get(this.hash.get(a)._previous).value}}},getFirst:function(){if(this.length==0){return null}return this.get(this.startID)},getLast:function(){if(this.length==0){return null}return this.get(this.endID)},values:function(){var a=new Array();var b=this.get(this.startID);while(b!=null&&b!=false){a.push(b);b=this.getNext(b.id)}return a},keys:function(){return this.hash.keys()},reverse:function(){var a=this.size();if(a<2){return}var e=this.getFirst().id;for(var b=a-1;b>0;b--){var d=this.getLast();this.popElement();var c=this.getPrevious(e);if(c==null){this.insert(null,d.id,d)}else{this.insert(c.id,d.id,d)}}this.hash.get(this.startID)._previous=null;this.hash.get(this.endID)._next=null},setValue:function(a,b){if(this.containsKey(a)){this.hash.get(a).value=b}}});
/*!
Math.uuid.js (v1.4)
http://www.broofa.com
mailto:robert@broofa.com

Copyright (c) 2009 Robert Kieffer
Dual licensed under the MIT and GPL licenses.
*/
Math.uuid=(function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");return function(b,e){var g=a,d=[];e=e||g.length;if(b){for(var c=0;c<b;c++){d[c]=g[0|Math.random()*e]}}else{var f;d[8]=d[13]=d[18]=d[23]="-";d[14]="4";for(var c=0;c<36;c++){if(!d[c]){f=0|Math.random()*16;d[c]=g[(c==19)?(f&3)|8:f]}}}return d.join("")}})();Math.uuid2=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d=="x"?b:(b&3|8);return a.toString(16)}).toUpperCase()};de.edirom.server.main.Module=Class.create({initialize:function(){this.toolbar=new de.edirom.server.main.Toolbar();this.views=new Array();$("viewSwitch").hide()},addView:function(a){this.views.push(a);if(this.views.size()==1){this.setActiveView(a)}if(this.views.size()>1){$("viewSwitch").show()}},setActiveView:function(a){this.setActiveView(a,null)},setActiveView:function(b,a){if(typeof(this.funcBeforeViewSwitch)=="function"){this.funcBeforeViewSwitch();this.funcBeforeViewSwitch=null}this.views.each(function(c){if(c==b){c.setActive(true,a)}else{c.setActive(false,a)}})},getActualContentKey:function(){var b;for(var a=0;a<this.views.size();a++){if(this.views[a].isActive()){b=this.views[a]}}if(typeof(b)!="undefined"){return b.getActiveContentKey()}return""}});de.edirom.server.main.MoveObjectCommand=Class.create({type:"MoveObjectCommand",initialize:function(b,d,a,c){this.subject=b;this.list=d;this.objectId=a;this.movedAfter=c;this.oldPreceding=this.subject.getPrecedingObjectID(d,a);this.undone=false},undo:function(){this.subject.moveObject(this.list,this.objectId,this.oldPreceding)},redo:function(){this.subject.moveObject(this.list,this.objectId,this.movedAfter)},getXQueryUpdate:function(){return this.subject.getXQueryUpdateList("move",this.list,this.objectId,this.movedAfter)},getType:function(){return this.type},getUndone:function(){return this.undone},setUndone:function(a){this.undone=a}});de.edirom.server.main.ObjectPicker=Class.create({initialize:function(e,c,h,d){var b=e.include("sources");var a=e.include("works");var g=e.include("texts");this.selectedFunc=h;if(!$("oPdiv")){var f=document.createElement("div");f.id="oPdiv";document.getElementsByTagName("body")[0].appendChild(f)}new Ajax.Updater("oPdiv","../main/xql/ObjectPicker.xql",{method:"get",parameters:{sources:b,works:a,texts:g,inputType:d},onComplete:function(i){if(c.length>0){c.each(function(j){if($("select_"+j)){$("select_"+j).checked=true}})}window.module.getShortcutController().addShortcutListener("popup","popup.objectPicker",this.shortcutListener.bind(this));Event.observe($("objectPicker_cancelButton"),"click",this.cancelButtonClick.bind(this));Event.observe($("objectPicker_okButton"),"click",this.okButtonClick.bind(this))}.bind(this),onFailure:function(i){console.log("ObjectPicker konnte nicht geladen werden: \n\n"+i.responseText)}})},closePopup:function(){window.module.getShortcutController().removeShortcutListener("popup","popup.objectPicker");Event.stopObserving($("objectPicker_cancelButton"));Event.stopObserving($("objectPicker_okButton"));$("objectPickerBox").remove()},cancelButtonClick:function(){this.closePopup()},okButtonClick:function(){var c=$$(".objectPicker_itemChecker input");var a=new Array();for(var b=0;b<c.length;b++){if(c[b].checked==true){a.push(c[b].id.substring(7))}}this.closePopup();if(typeof(selectedFunc)!="null"){this.selectedFunc(a)}},shortcutListener:function(a){if(a.keyCode==Event.KEY_RETURN){this.okButtonClick();return true}if(a.keyCode==Event.KEY_ESC){this.cancelButtonClick();return true}return false}});de.edirom.server.main.RemoveObjectCommand=Class.create({type:"RemoveObjectCommand",initialize:function(b,c,a){this.subject=b;this.list=c;this.object=a;this.oldPreceding=(a.id?this.subject.getPrecedingObjectID(c,a.id):null);this.undone=false},undo:function(){this.subject.addObject(this.list,this.object);if(this.object.id){this.subject.moveObject(this.list,this.object.id,this.oldPreceding)}},redo:function(){if(this.object.id){this.subject.removeObject(this.list,this.object.id)}else{this.subject.removeObject(this.list,this.object)}},getXQueryUpdate:function(){if(this.object.id){return this.subject.getXQueryUpdateList("remove",this.list,this.object.id)}else{return this.subject.getXQueryUpdateList("remove",this.list,this.object)}},getType:function(){return this.type},getUndone:function(){return this.undone},setUndone:function(a){this.undone=a}});if(typeof de=="undefined"){de={}}if(typeof de.edirom=="undefined"){de.edirom={}}if(typeof de.edirom.server=="undefined"){de.edirom.server={}}de.edirom.server.Scrollview=Class.create({initialize:function(a,g,d){this.viewId=a;this.view=$(a);if(typeof(d)=="object"){this.minDrawbarLengthV=d[0];this.minDrawbarLengtH=d[1]}else{this.minDrawbarLengthV=d;this.minDrawbarLengthH=d}this.view.setStyle({overflow:"hidden"});if(this.view.getStyle("position")=="static"){this.view.setStyle({position:"relative"})}var b=this.viewId+"_scrollViewFrame";var f=new Element("div",{id:b});this.frameWidth=getBoxModelWidth(this.view,"inner");this.frameHeight=getBoxModelHeight(this.view,"inner");f.setStyle({width:this.frameWidth+"px",height:this.frameHeight+"px",overflow:"hidden",whiteSpace:"normal"});var c=this.viewId+"_scrollViewInnerFrame";var e=new Element("div",{id:c});e.setStyle({width:"auto",height:"auto",overflow:"hidden",display:"inline"});e.update(this.view.innerHTML);f.update(e);this.view.update(f);this.vFrame=f;this.hFrame=f;this.vFrameId=b;this.hFrameId=b;this.vFrameInner=e;this.hFrameInner=e;this.vFrameInnerId=c;this.hFrameInnerId=c;this.vScrollbar=null;this.hScrollbar=null;this.vThickness=0;this.hThickness=0;this.scrollbarTopOffset=0;this.scrollbarBottomOffset=0;this.cornerRectId=this.viewId+"_cornerRect";this.cornerRect=new Element("div",{id:this.cornerRectId});this.cornerRect.setStyle({position:"absolute",bottom:"0px",right:"0px",display:"none"});this.cornerRect.addClassName("cornerRect");this.view.insert({top:this.cornerRect});if(g){Event.observe(document.onresize?document:window,"resize",function(h){if(this.calcOwnTableWidths&&this.refreshTableWidths){this.refreshTableWidths()}this.refresh()}.bindAsEventListener(this))}},setTableScrolling:function(d,b,c,a){this.vFrame=$(a);this.vFrameId=a;this.vFrameInner=$(c);this.vFrameInnerId=c;this.scrollbarTopOffset=getBoxModelHeight($(d),"outer");if(b!=null){this.scrollbarBottomOffset=getBoxModelHeight($(b),"outer")}this.refresh()},setVerticalScrolling:function(d){if(this.deactivated){return}if(!d&&this.vScrollbar){var b=this.vScrollbar.getScrollbar();this.vScrollbar=null;b.remove();this.hFrame.setStyle({width:"auto"});this.frameWidth=getBoxModelWidth(this.hFrame,"inner");this.vThickness=0;this.updateCornerRect()}else{if(d&&!this.vScrollbar){var e=this.viewId+"_vScrollbar";var a=new Element("div",{id:e});var c;if(this.scrollbarTopOffset>0){c=this.scrollbarTopOffset}else{c=this.vFrame.getStyle("padding-top")}a.setStyle({position:"absolute",right:"0px",height:this.frameHeight+"px",top:c+"px"});a.addClassName("scrollbarV");this.view.insert({top:a});this.vThickness=getBoxModelWidth(a,"native");this.frameWidth=getBoxModelWidth(this.hFrame,"inner")-this.vThickness;this.hFrame.setStyle({width:this.frameWidth+"px"});if(this.hScrollbar){this.hScrollbar.getScrollbar().setStyle({width:this.frameWidth+"px"});this.hScrollbar.updateDragbar()}this.vScrollbar=new de.edirom.server.Scrollbar(e,this.vFrameId,this.vFrameInnerId,"vertical",this.minDrawbarLengthV);this.vScrollbar.getDragbar().addClassName("dragbarV");this.updateCornerRect()}}},setHorizontalScrolling:function(c){if(this.deactivated){return}if(!c&&this.hScrollbar){var b=this.hScrollbar.getScrollbar();this.hScrollbar=null;b.remove();this.vFrame.setStyle({height:"auto"});this.vFrame.setStyle({whiteSpace:"normal"});this.frameHeight=getBoxModelHeight(this.vFrame,"inner");this.hThickness=0;this.updateCornerRect()}else{if(c&&!this.hScrollbar){var d=this.viewId+"_hScrollbar";var a=new Element("div",{id:d});a.setStyle({position:"absolute",bottom:"0px",width:this.frameWidth+"px",left:"0px"});a.addClassName("scrollbarH");this.view.insert({top:a});this.hThickness=getBoxModelHeight(a,"native");this.frameHeight=getBoxModelHeight(this.vFrame,"inner")-this.hThickness;this.vFrame.setStyle({height:this.frameHeight+"px"});this.vFrame.setStyle({whiteSpace:"nowrap"});if(this.vScrollbar){this.vScrollbar.getScrollbar().setStyle({height:this.frameHeight+"px"});this.vScrollbar.updateDragbar()}this.hScrollbar=new de.edirom.server.Scrollbar(d,this.hFrameId,this.hFrameInnerId,"horizontal",this.minDrawbarLengthH);this.hScrollbar.getDragbar().addClassName("dragbarH");this.updateCornerRect()}}},refresh:function(a,d){if(this.deactivated){return}var c=this.vFrame.ancestors();for(var b=0;b<c.length;b++){if(!c[b].visible()){return}}this.hFrame.setStyle({height:"auto"});this.vFrame.setStyle({width:"auto"});this.vFrame.setStyle({height:"auto",maxHeight:"none"});this.frameWidth=getBoxModelWidth(this.view,"inner")-this.vThickness;this.frameHeight=getBoxModelHeight(this.view,"inner")-this.hThickness;this.hFrame.setStyle({width:this.frameWidth+"px",height:this.frameHeight+"px"});if(this.hFrame!=this.vFrame){this.vFrame.setStyle({width:this.frameWidth+"px",height:this.frameHeight+"px"})}this.frameHeight-=this.scrollbarTopOffset+this.scrollbarBottomOffset;this.vFrame.setStyle({height:this.frameHeight+"px",maxHeight:getBoxModelHeight(this.hFrameInner,"outer")+"px"});if(this.vScrollbar){this.vScrollbar.getScrollbar().setStyle({height:this.frameHeight+"px"});if(!d){this.vScrollbar.updateDragbar()}else{if(d<0){d=0}this.vScrollbar.scrollToOffset(-d)}}if(this.hScrollbar){this.hScrollbar.getScrollbar().setStyle({width:this.frameWidth+"px"});if(!a){this.hScrollbar.updateDragbar()}else{if(a<0){a=0}this.hScrollbar.scrollToOffset(-a)}}},focusElement:function(a,d){if(this.deactivated){return}var c=0;var b=0;if(typeof(d)=="object"){c=d[0];b=d[1]}else{if(d){c=d;b=d}}if(c=="center"){c=this.frameWidth*0.5-$(a).getWidth()*0.5}if(b=="center"){b=this.frameHeight*0.5-$(a).getHeight()*0.5}this.refresh(($(a).viewportOffset()[0]-this.hFrameInner.viewportOffset()[0])-c,($(a).viewportOffset()[1]-this.vFrameInner.viewportOffset()[1])-b)},updateCornerRect:function(){if(this.vScrollbar&&this.hScrollbar){this.cornerRect.setStyle({width:this.vThickness+"px",height:this.hThickness+"px"});this.cornerRect.show()}else{this.cornerRect.hide()}},deactivate:function(){if(this.deactivated){return}this.backupFrameStyle=this.vFrame.readAttribute("style");this.vFrame.writeAttribute({style:""});this.backupFrameInnerStyle=this.vFrameInner.readAttribute("style");this.vFrameInner.writeAttribute({style:""});if(this.vScrollbar){$(this.viewId+"_vScrollbar").hide()}if(this.hScrollbar){$(this.viewId+"_hScrollbar").hide()}this.deactivated=true},reactivate:function(){if(!this.deactivated){return}if(this.backupFrameStyle!=null){this.vFrame.writeAttribute({style:this.backupFrameStyle});this.backupFrameStyle=null}if(this.backupFrameInnerStyle!=null){this.vFrameInner.writeAttribute({style:this.backupFrameInnerStyle});this.backupFrameInnerStyle=null}if(this.vScrollbar){$(this.viewId+"_vScrollbar").show()}if(this.hScrollbar){$(this.viewId+"_hScrollbar").show()}this.deactivated=false}});de.edirom.server.Scrolltable=Class.create(de.edirom.server.Scrollview,{initialize:function($super,n,c,b,d){tableFirstRow=firstDisplayed($(c),"tr").select("td, th");this.syncWidthsArray=new Array(tableFirstRow.length);for(var e=0;e<tableFirstRow.length;e++){this.syncWidthsArray[e]=getBoxModelWidth(tableFirstRow[e],"inner")}var l=$(c).cloneNode(false);this.headTableId=$(c).identify()+"_scrollHeadTable";l.writeAttribute({id:this.headTableId});l.setStyle({whiteSpace:"nowrap",width:"auto",paddingBottom:"0px",marginBottom:"0px"});var h=$(c).cloneNode(false);this.footTableId=$(c).identify()+"_scrollFootTable";h.writeAttribute({id:this.footTableId});h.setStyle({whiteSpace:"nowrap",width:"auto",paddingTop:"0px",marginTop:"0px",borderTop:"0px hidden"});var f=$(c);this.bodyTableId=$(c).identify()+"_scrollBodyTable";f.writeAttribute({id:this.bodyTableId});f.setStyle({whiteSpace:"nowrap",width:"auto",paddingTop:"0px",marginTop:"0px",borderTop:"0px hidden"});var m=f.childElements();for(var e=0;e<m.length;e++){if(m[e].match("thead")){l.insert({bottom:m[e].remove()})}else{if(m[e].match("tfoot")){h.insert({bottom:m[e].remove()})}}}f.insert({before:l});if(h.childElements().length>0){f.insert({after:h});f.setStyle({paddingBottom:"0px",marginBottom:"0px"})}else{h=null;this.footTableId=null}this.bodyTableWrapperId=this.bodyTableId+"_scrollBodyWrapper";var k=new Element("div",{id:this.bodyTableWrapperId});var a=getBoxModelWidth($(n),"inner");var g=getBoxModelHeight($(n),"inner")-l.getHeight();if(h!=null){g-=h.getHeight()}var j=getBoxModelHeight(f,"outer");k.setStyle({width:a+"px",height:g+"px",maxHeight:j+"px",overflow:"hidden",whiteSpace:"normal"});Element.wrap(f,k);$super(n,b,d);this.setTableScrolling(this.headTableId,this.footTableId,this.bodyTableId,this.bodyTableWrapperId);this.isHeadSynced=false;this.isBodySynced=false;this.isFootSynced=false;this.synchronizeColumnWidths()},synchronizeColumnWidths:function(){if(!this.isHeadSynced&&displayedExists($(this.headTableId),"tr")){this.headFirstRow=firstDisplayed($(this.headTableId),"tr").select("td, th");for(var a=0;a<this.headFirstRow.length;a++){this.headFirstRow[a].setStyle({width:this.syncWidthsArray[a]+"px",minWidth:this.syncWidthsArray[a]+"px"})}this.isHeadSynced=true}if(!this.isBodySynced&&displayedExists($(this.bodyTableId),"tr")){currentFirstRow=firstDisplayed($(this.bodyTableId),"tr").select("td, th");if(this.bodyFirstRow&&currentFirstRow!=this.bodyFirstRow){for(var a=0;a<this.bodyFirstRow.length;a++){this.bodyFirstRow[a].setStyle({width:"auto",minWidth:"0",maxWidth:"none"})}}this.bodyFirstRow=currentFirstRow;for(var a=0;a<this.bodyFirstRow.length;a++){this.bodyFirstRow[a].setStyle({width:this.syncWidthsArray[a]+"px",minWidth:this.syncWidthsArray[a]+"px"})}this.isBodySynced=true}if(!this.isFootSynced&&this.footTableId!=null&&displayedExists($(this.footTableId),"tr")){this.footFirstRow=firstDisplayed($(this.footTableId),"tr").select("td, th");for(var a=0;a<this.footFirstRow.length;a++){this.footFirstRow[a].setStyle({width:this.syncWidthsArray[a]+"px",minWidth:this.syncWidthsArray[a]+"px"})}this.isFootSynced=true}if(this.calcOwnTableWidths){this.refreshTableWidths()}},refreshTable:function(){if(this.deactivated){return}this.isHeadSynced=false;this.isBodySynced=false;this.isFootSynced=false;this.synchronizeColumnWidths()},setTableWidths:function(c,f){if(this.deactivated){return}if(c){for(var b=0;b<c.length;b++){var a=c[b][0];var e=c[b][1];this.syncWidthsArray[a]=e;if(displayedExists($(this.headTableId),"tr")){this.headFirstRow[a].setStyle({width:e+"px",minWidth:e+"px"})}if(displayedExists($(this.bodyTableId),"tr")){this.bodyFirstRow[a].setStyle({width:e+"px",minWidth:e+"px"})}if(this.footTableId!=null&&displayedExists($(this.footTableId),"tr")){this.footFirstRow[a].setStyle({width:e+"px",minWidth:e+"px"})}}}if(!f){return}for(var b=0;b<f.length;b++){this.syncWidthsArray[f[b][0]]=0}var d=0;for(var b=0;b<this.syncWidthsArray.length;b++){if(this.syncWidthsArray[b]>0){d+=getBoxModelWidth(this.headFirstRow[b],"outer")}}this.percentualWidths=f;this.initPercArea=getBoxModelWidth(this.hFrame,"inner")-d-window.innerWidth;this.refreshTableWidths();this.calcOwnTableWidths=true},refreshTableWidths:function(){if(this.deactivated){return}var b=this.initPercArea+window.innerWidth;for(var c=0;c<this.percentualWidths.length;c++){var a=this.percentualWidths[c][0];var d=getBoxModelWidth(this.headFirstRow[a],"outer")-getBoxModelWidth(this.headFirstRow[a],"inner");var e=this.percentualWidths[c][1]*b/100-d;if(displayedExists($(this.headTableId),"tr")){this.headFirstRow[a].setStyle({width:e+"px",minWidth:e+"px",maxWidth:e+"px"})}if(displayedExists($(this.bodyTableId),"tr")){this.bodyFirstRow[a].setStyle({width:e+"px",minWidth:e+"px",maxWidth:e+"px"})}if(this.footTableId!=null&&displayedExists($(this.footTableId),"tr")){this.footFirstRow[a].setStyle({width:e+"px",minWidth:e+"px",maxWidth:e+"px"})}}},setVerticalScrolling:function($super,d){if(this.deactivated){return}var a=d&&!this.vScrollbar;var b=!d&&this.vScrollbar;$super(d);if(a||b){var c=this.syncWidthsArray.last();if(a){c-=this.vThickness}else{c+=this.vThickness}this.syncWidthsArray[this.syncWidthsArray.length-1]=c;if(this.bodyFirstRow!=null&&this.bodyFirstRow.last()!=null){this.bodyFirstRow.last().setStyle({width:c+"px",minWidth:c+"px"})}if(this.headFirstRow!=null&&this.headFirstRow.last()!=null){this.headFirstRow.last().setStyle({width:c+"px",minWidth:c+"px"})}if(this.footFirstRow!=null&&this.footFirstRow.last()!=null){this.footFirstRow.last().setStyle({width:c+"px",minWidth:c+"px"})}}},refresh:function($super,a,b){if(this.deactivated){return}this.synchronizeColumnWidths();$super(a,b)}});de.edirom.server.Scrollbar=Class.create({initialize:function(a,d,f,c,e){this.scrollbar=$(a);this.contentView=$(d);this.content=$(f);c=c.toLowerCase();if(c=="horizontal"||c=="h"||c=="x"){this.vScroll=false;this.mousewheelScrolling=false}else{this.vScroll=true;this.mousewheelScrolling=true}if(this.vScroll){this.content.setStyle({position:"relative",top:"0px"})}else{this.content.setStyle({position:"relative",left:"0px"})}if(this.vScroll){this.drawbarPaddingLongitudinal=getCssIntAttr(this.scrollbar,"padding-top")+getCssIntAttr(this.scrollbar,"padding-bottom")}else{this.drawbarPaddingLongitudinal=getCssIntAttr(this.scrollbar,"padding-left")+getCssIntAttr(this.scrollbar,"padding-right")}if(!e){this.minDbHeight=12}else{this.minDbHeight=Math.max(2,e)}this.r;this.p=0;this.contentFits;var b=a;if(this.vScroll){b+="_vDragbar"}else{b+="_hDragbar"}this.dragbar=new Element("div",{id:b});this.scrollbar.insert({top:this.dragbar});this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventMouseWheel=this.updateWheel.bindAsEventListener(this);this.observe=false;this.dragging=false;this.updateDragbar()},getScrollbar:function(){return this.scrollbar},getDragbar:function(){return this.dragbar},updateDragbar:function(){this.dragbar.setStyle({position:"absolute"});this.refreshScrollTargetValues();if(this.vScroll){this.dragbar.setStyle({width:getBoxModelWidth(this.scrollbar,"inner")+"px",height:this.r+"px",top:this.p+"px"})}else{this.dragbar.setStyle({height:getBoxModelHeight(this.scrollbar,"inner")+"px",width:this.r+"px",left:this.p+"px"})}this.startObserving();if(this.contentFits){this.scrollbar.setStyle({visibility:"hidden"});this.stopObserving();if(this.vScroll){this.content.setStyle({top:"0px"})}else{this.content.setStyle({left:"0px"})}}else{this.scrollbar.setStyle({visibility:"visible"})}},refreshScrollTargetValues:function(){if(this.vScroll){this.contentViewHeight=this.contentView.getHeight();this.contentHeight=this.content.getHeight()}else{this.contentViewHeight=this.contentView.getWidth();this.contentHeight=this.content.getWidth()}if(this.vScroll){this.scrollbarHeight=this.scrollbar.getHeight()}else{this.scrollbarHeight=this.scrollbar.getWidth()}this.scrollbarHeight-=this.drawbarPaddingLongitudinal*2;this.r=this.scrollbarHeight;if(this.contentHeight>this.contentViewHeight){var c=Math.ceil((this.contentViewHeight/this.contentHeight)*this.r);this.r=Math.max(this.minDbHeight,c);var a=this.r-c;this.contentFits=false}else{this.contentFits=true}var b;if(this.vScroll){b=parseInt(this.content.getStyle("top"))}else{b=parseInt(this.content.getStyle("left"))}var d;if(this.contentHeight>this.contentViewHeight){d=Math.min(0,b/this.contentHeight)}else{d=0}this.p=Math.floor(-d*(this.scrollbarHeight-a))+this.drawbarPaddingLongitudinal},setMousewheelScrolling:function(a){if(a&&this.observe&&!this.mousewheelScrolling){this.contentView.observe("mousewheel",this.eventMouseWheel);this.contentView.observe("DOMMouseScroll",this.eventMouseWheel);this.scrollbar.observe("mousewheel",this.eventMouseWheel);this.scrollbar.observe("DOMMouseScroll",this.eventMouseWheel)}else{if(!a&&this.observe&&this.mousewheelScrolling){this.contentView.stopObserving("mousewheel",this.eventMouseWheel);this.contentView.stopObserving("DOMMouseScroll",this.eventMouseWheel);this.scrollbar.stopObserving("mousewheel",this.eventMouseWheel);this.scrollbar.stopObserving("DOMMouseScroll",this.eventMouseWheel)}}this.mousewheelScrolling=a},startObserving:function(){if(this.observe){return}this.scrollbar.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);if(this.mousewheelScrolling){this.contentView.observe("mousewheel",this.eventMouseWheel);this.contentView.observe("DOMMouseScroll",this.eventMouseWheel);this.scrollbar.observe("mousewheel",this.eventMouseWheel);this.scrollbar.observe("DOMMouseScroll",this.eventMouseWheel)}this.observe=true},stopObserving:function(){if(!this.observe){return}this.scrollbar.stopObserving("mousedown",this.eventMouseDown);document.stopObserving("mouseup",this.eventMouseUp);document.stopObserving("mousemove",this.eventMouseMove);if(this.mousewheelScrolling){this.contentView.stopObserving("mousewheel",this.eventMouseWheel);this.contentView.stopObserving("DOMMouseScroll",this.eventMouseWheel);this.scrollbar.stopObserving("mousewheel",this.eventMouseWheel);this.scrollbar.stopObserving("DOMMouseScroll",this.eventMouseWheel)}this.observe=false},startDrag:function(b){if(Event.isLeftClick(b)&&!this.dragging){if(b.findElement()==this.scrollbar){var a;if(this.vScroll){a=(Event.pointerY(b)-this.scrollbar.cumulativeOffset()[1]-(this.dragbar.getHeight()/2))/this.scrollbar.getHeight()}else{a=(Event.pointerX(b)-this.scrollbar.cumulativeOffset()[0]-(this.dragbar.getWidth()/2))/this.scrollbar.getWidth()}this.scrollToNormalizedOffset(a)}else{this.dragging=true;if(this.vScroll){this.startPointer=Event.pointerY(b);this.startScrollingAt=parseInt(this.content.getStyle("top"))}else{this.startPointer=Event.pointerX(b);this.startScrollingAt=parseInt(this.content.getStyle("left"))}}}Event.stop(b)},endDrag:function(a){this.dragging=false;Event.stop(a)},updateDrag:function(b){if(this.dragging){if(this.vScroll){distance=this.startPointer-Event.pointerY(b)}else{distance=this.startPointer-Event.pointerX(b)}var a=distance/this.scrollbarHeight;if(a>1||a<-1){return}this.scrollToOffset(this.startScrollingAt+(a*this.contentHeight));Event.stop(b)}},updateWheel:function(a){if(this.vScroll){this.scroll(Event.wheel(a)*10)}else{this.scroll(Event.wheel(a)*10)}Event.stop(a)},scroll:function(b){var a;if(this.vScroll){a=parseInt(this.content.getStyle("top"))}else{a=parseInt(this.content.getStyle("left"))}a+=b;this.scrollToOffset(a)},scrollToOffset:function(a){if(this.vScroll){this.contentViewHeight=this.contentView.getHeight();this.contentHeight=this.content.getHeight()}else{this.contentViewHeight=this.contentView.getWidth();this.contentHeight=this.content.getWidth()}if(this.contentViewHeight>=this.contentHeight){a=0}else{a=Math.max(Math.min(0,a),-(this.contentHeight-this.contentViewHeight))}if(this.vScroll){this.content.setStyle({top:a+"px"})}else{this.content.setStyle({left:a+"px"})}this.updateDragbar()},scrollToNormalizedOffset:function(a){if(this.vScroll){this.scrollToOffset(-(a*this.content.getHeight()))}else{this.scrollToOffset(-(a*this.content.getWidth()))}}});de.edirom.server.main.ShortcutController=Class.create({initialize:function(){this.listeners=new de.edirom.server.main.LinkedHashMap();this.inactiveHashMaps=new Hash();Event.observe(document,"keydown",this.fireShortcut.bindAsEventListener(this))},debug:function(){console.log("listeners:");console.log(this.listeners.keys());console.log("inactive:");console.log(this.inactiveHashMaps.keys())},addShortcutListener:function(a,d,b){if(!this.listenerExists(d)){var c=new de.edirom.server.main.ShortcutListener(a,d,b);if(this.listenerTypeExists(a)){this.replaceListener(c)}else{this.addOrReuseListener(c)}}},listenerTypeExists:function(a){var b=false;this.listeners.each(function(c){b=(c.type==a||b)});return b},replaceListener:function(a){this.saveListeners(a.type);this.addOrReuseListener(a)},addOrReuseListener:function(b){if(this.inactiveHashMaps.keys().indexOf(b.id)!=-1){var a=this.inactiveHashMaps.get(b.id);this.inactiveHashMaps.unset(b.id);a.each(function(c){this.listeners.pushElement(c.id,c)}.bind(this))}else{this.listeners.pushElement(b.id,b)}},listenerExists:function(a){return this.listeners.containsKey(a)},saveListeners:function(b){var c=new de.edirom.server.main.LinkedHashMap();var a=this.listeners.getLast();this.listeners.popElement();c.pushElement(a.id,a);while(a.type!=b){a=this.listeners.getLast();this.listeners.popElement();c.pushElement(a.id,a)}if(c.size()>1){c.reverse();this.inactiveHashMaps.set(c.getFirst().id,c)}},removeShortcutListener:function(a,b){if(this.listenerExists(b)){this.saveListeners(a)}},fireShortcut:function(c){var a=false;var b=this.listeners.getLast();while(b!=null&&!a){a=b.callFunc(c);b=this.listeners.getPrevious(b.id)}if(a){c.preventDefault();return false}}});de.edirom.server.main.ShortcutListener=Class.create({initialize:function(a,c,b){this.type=a;this.id=c;this.func=b},callFunc:function(a){return this.func(a)}});de.edirom.server.main.Sidebar=Class.create({SIDEBAR_WIDTH:285,activeContent:null,initialize:function(b){this.id=b+"_sidebar";var a=4;this.SIDEBAR_WIDTH+=a;if($("_sidebar")){$("_sidebar").writeAttribute({id:this.id})}else{$(b).insert({bottom:'<div class="sidebar" id="'+this.id+'"></div>'})}$(this.id).style.width="0px";this.contents=new Array();this.scrollview=new de.edirom.server.Scrollview(this.id,true);this.scrollview.setVerticalScrolling(true)},getId:function(){return id},checkVisible:function(){return(this.activeContent!=null)},getActiveContent:function(){return this.activeContent},getContentContainerId:function(){return this.scrollview.vFrameInnerId},addContent:function(a){this.contents.push(a)},showContent:function(a){this.activeContent=a;this.startSidebarExpandAnimation()},startSidebarExpandAnimation:function(){$(this.id).morph("width:"+this.SIDEBAR_WIDTH+"px;",{duration:0.8,queue:"end",afterFinish:this.sidebarExpandAnimationFinished.bind(this)})},sidebarExpandAnimationFinished:function(){this.scrollview.refresh();this.activeContent.show();this.scrollview.refresh()},hideContent:function(a){this.activeContent=a;this.startSidebarRetractAnimation()},startSidebarRetractAnimation:function(){$(this.id).morph("width:0px;",{duration:0.8,queue:"end",afterFinish:this.sidebarRetractAnimationFinished.bind(this)})},sidebarRetractAnimationFinished:function(){this.activeContent.hide();this.activeContent=null;if(this.showAfterHide!=null){this.showContent(this.showAfterHide);this.showAfterHide=null}},toggleSidebarContent:function(a){if(this.activeContent==null){a.requestShow();this.showContent(a)}else{if(this.activeContent==a){a.requestHide();this.hideContent(a)}else{if(this.activeContent!=null&&a==null){this.activeContent.requestHide();this.hideContent(this.activeContent)}else{this.activeContent.requestHide();a.requestShow();this.showAfterHide=a;this.hideContent(this.activeContent)}}}}});de.edirom.server.main.SidebarContent=Class.create({visibilityChangeRequestedListeners:null,visibilityChangedListeners:null,initialize:function(b,a){this.sidebar=b;this.id=a;this.loaded=false;if(!$(b)){$(b).insert({bottom:'<div class="sidebarContent" id="'+this.id+'"></div>'})}$(this.id).setStyle({display:"none"})},load:function(){this.loaded=true},isLoaded:function(){return this.loaded},requestHide:function(){this.visibilityChangeRequestedListeners.each(function(a){a.visibilityChangeRequested(false)})},hide:function(){$(this.id).setStyle({display:"none"})},requestShow:function(){this.visibilityChangeRequestedListeners.each(function(a){a.visibilityChangeRequested(true)}.bind(this))},show:function(){$(this.id).setStyle({display:"block"});if(this.visibilityChangedListeners){this.visibilityChangedListeners.each(function(a){a.visibilityChanged(true)}.bind(this))}},reload:function(){},addVisibilityChangeRequestedListener:function(a){this.visibilityChangeRequestedListeners.push(a)},addVisibilityChangedListener:function(a){this.visibilityChangedListeners.push(a)}});de.edirom.server.main.TabBar=Class.create({initialize:function(){this.tabs=new Array()},addTab:function(a){this.tabs.push(a);if(this.tabs.length==1){a.activate()}else{a.deactivate(true)}},setActive:function(a){this.tabs.each(function(b){if(b==a){b.activate()}else{b.deactivate()}})},getId:function(){return"tabBoxItems"},hide:function(){$("objectTabBox").style.display="none";$("objectHeadFrame").style.height="72px"},show:function(){$("objectTabBox").style.display="block";$("objectHeadFrame").style.height="97px"}});de.edirom.server.main.Tab=Class.create({initialize:function(a,b,c){this.active=false;this.tabBar=a;this.label=b;this.content=c;this.id="tab_"+b;$(a.getId()).insert({bottom:'<div id="'+this.id+'" class="ediromDetailTab">'+b+"</div>"});Event.observe($(this.id),"click",this.tabClicked.bind(this))},tabClicked:function(a){if(!this.active){this.tabBar.setActive(this)}},activate:function(){if(this.active){return}this.active=true;this.content.setVisible(true);$(this.id).addClassName("activeTab")},deactivate:function(a){if((typeof(a)!="undefined"&&!a)&&!this.active){return}this.active=false;this.content.setVisible(false);$(this.id).removeClassName("activeTab")}});de.edirom.server.Tabs=Class.create({initialize:function(c,b,e){this.contentContainerId=b;this.tabsBarContainerId=c;this.tabsBarId=c+"-nav";this.moveBackId=c+"-back";this.moveForId=c+"-for";this.tabContentClassName="tabContent";this.tabLinkClassName="tabLink";this.tabActiveLinkClassName="tabActiveLink";$(this.tabsBarContainerId).insert({top:'<div id="'+this.moveBackId+'" class="tabBackButton" style="display:inline-block; float:left;"></div><div style="display:inline-block; float:left; overflow:hidden">	<div id="'+this.tabsBarId+'" style="white-space:nowrap">	</div></div><div id="'+this.moveForId+'" class="tabForButton" style="display:inline-block; float: left;"></div>		'});$(this.moveBackId).observe("click",this.moveBack.bindAsEventListener(this));$(this.moveForId).observe("click",this.moveFor.bindAsEventListener(this));this.yetiiTabs=new Yetii({id:this.contentContainerId,tabsId:this.tabsBarId,tabclass:this.tabContentClassName,activeclass:this.tabActiveLinkClassName,callback:this.showTabLink.bind(this)});this.stdMoveOverhead=10;this.overlapTolerance=20;this.stdMoveDuration=0.5;this.moveDurationBounds=[0.3,2];this.position=0;if(e){Event.observe(document.onresize?document:window,"resize",this.refreshMenu.bindAsEventListener(this))}var a=$(this.contentContainerId).childElements();for(var d=0;d<a.length;d++){this.addTab(a[d],false,true)}this.unlocked=true},refreshMenu:function(){this.navWidthPx=$(this.tabsBarContainerId).getWidth();if(this.getOffsetPositionOfTab(-1,"right")>this.navWidthPx){this.navWidthPx-=(getBoxModelWidth($(this.moveBackId),"outer")+getBoxModelWidth($(this.moveForId),"outer")+2);$(this.moveBackId).show();$(this.moveForId).show()}else{$(this.moveBackId).hide();$(this.moveForId).hide()}$(this.tabsBarId).ancestors()[0].setStyle({width:this.navWidthPx+"px"})},addTab:function(d,b,a){if(!b){var b;if(d.readAttribute("title")){b=d.readAttribute("title")}else{b="Tab "+($(this.tabsBarId).childElements().length+1)}}d.setStyle({display:"none"});d.addClassName(this.tabContentClassName);if(!a){$(this.contentContainerId).insert({bottom:d})}var c=new Element("div");c.setStyle({display:"inline-block",cursor:"pointer"});c.addClassName(this.tabLinkClassName);c.innerHTML=b;$(this.tabsBarId).insert({bottom:c});this.yetiiTabs.refresh();this.refreshMenu()},moveBack:function(d,f){if(!this.unlocked){return}if(!f){var c=$(this.tabsBarId).childElements().length-1;var b=1;while(b<=c&&this.getOffsetPositionOfTab(b,"left")<(this.position-this.overlapTolerance)){b++}this.showTabLink(b);return}duration=Math.min(this.moveDurationBounds[1],Math.max(this.moveDurationBounds[0],f/100*this.stdMoveDuration));var a=-Math.min(0,this.position-f);var e=f-a;new Effect.Move(this.tabsBarId,{x:e,y:0,duration:duration,transition:Effect.Transitions.sinoidal,afterFinish:this.unlock.bind(this)});this.unlocked=false;this.position-=e},moveFor:function(d,g){if(!this.unlocked){return}if(!g){var c=$(this.tabsBarId).childElements().length-1;var b=1;while(b<=c&&this.getOffsetPositionOfTab(b,"right")<(this.position+$(this.tabsBarId).getWidth()+this.overlapTolerance)){b++}b++;this.showTabLink(b);return}duration=Math.min(this.moveDurationBounds[1],Math.max(this.moveDurationBounds[0],g/100*this.stdMoveDuration));var f=this.getOffsetPositionOfTab(-1)-$(this.tabsBarId).getWidth();var a=Math.max(f,this.position+g)-f;var e=g-a;new Effect.Move(this.tabsBarId,{x:-e,y:0,duration:duration,transition:Effect.Transitions.sinoidal,afterFinish:this.unlock.bind(this)});this.unlocked=false;this.position+=e},showTabLink:function(b){var a;if((a=this.getOffsetPositionOfTab(b-1,"left"))<this.position){this.moveBack(false,-(a-this.position)+this.stdMoveOverhead)}else{if((a=this.getOffsetPositionOfTab(b-1,"right"))>(this.position+$(this.tabsBarId).getWidth())){this.moveFor(false,a-$(this.tabsBarId).getWidth()-this.position+this.stdMoveOverhead)}}},gotoTabNumber:function(a){this.yetiiTabs.show(a)},gotoTab:function(a){tabs=$(this.contentContainerId).childElements();for(var b=0;b<tabs.length;b++){if(tabs[b]==a){this.gotoTabNumber(b+1);break}}},getOffsetPositionOfTab:function(b,a){tabs=$(this.tabsBarId).childElements();if(b<0||b>tabs.length-1){b=tabs.length-1}sum=0;for(var c=0;c<=b;c++){sum+=getBoxModelWidth(tabs[c],"outer")}if(a=="left"){sum-=getBoxModelWidth(tabs[b],"outer")}return sum},unlock:function(){this.unlocked=true}});function Yetii(){this.defaults={id:null,tabsId:null,active:1,interval:null,wait:null,persist:null,tabclass:"tab",activeclass:"active",callback:null,leavecallback:null};this.activebackup=null;for(var a in arguments[0]){this.defaults[a]=arguments[0][a]}this.getTabs=function(){var b=[];var d=document.getElementById(this.defaults.id).getElementsByTagName("*");var e=new RegExp("(^|\\s)"+this.defaults.tabclass.replace(/\-/g,"\\-")+"(\\s|$)");for(var c=0;c<d.length;c++){if(e.test(d[c].className)){b.push(d[c])}}return b};this.show=function(c){if(c<1||c>this.tabs.length){return}for(var b=0;b<this.tabs.length;b++){this.tabs[b].style.display=((b+1)==c)?"block":"none";if((b+1)==c){this.addClass(this.links[b],this.defaults.activeclass)}else{this.removeClass(this.links[b],this.defaults.activeclass)}}if(this.defaults.leavecallback&&(c!=this.activebackup)){this.defaults.leavecallback(this.defaults.active)}this.activebackup=c;this.defaults.active=c;if(this.defaults.callback){this.defaults.callback(c)}};this.rotate=function(c){this.show(this.defaults.active);this.defaults.active++;if(this.defaults.active>this.tabs.length){this.defaults.active=1}var b=this;if(this.defaults.wait){clearTimeout(this.timer2)}this.timer1=setTimeout(function(){b.rotate(c)},c*1000)};this.next=function(){var b=(this.defaults.active+1>this.tabs.length)?1:this.defaults.active+1;this.show(b);this.defaults.active=b};this.previous=function(){var b=((this.defaults.active-1)==0)?this.tabs.length:this.defaults.active-1;this.show(b);this.defaults.active=b};this.previous=function(){this.defaults.active--;if(!this.defaults.active){this.defaults.active=this.tabs.length}this.show(this.defaults.active)};this.gup=function(c){c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+c+"=([^&#]*)";var e=new RegExp(b);var d=e.exec(window.location.href);if(d==null){return null}else{return d[1]}};this.parseurl=function(d){var b=this.gup(d);if(b==null){return null}if(parseInt(b)){return parseInt(b)}if(document.getElementById(b)){for(var c=0;c<this.tabs.length;c++){if(this.tabs[c].id==b){return(c+1)}}}return null};this.createCookie=function(d,e,f){if(f){var c=new Date();c.setTime(c.getTime()+(f*24*60*60*1000));var b="; expires="+c.toGMTString()}else{var b=""}document.cookie=d+"="+e+b+"; path=/"};this.readCookie=function(d){var f=d+"=";var b=document.cookie.split(";");for(var e=0;e<b.length;e++){var g=b[e];while(g.charAt(0)==" "){g=g.substring(1,g.length)}if(g.indexOf(f)==0){return g.substring(f.length,g.length)}}return null};this.contains=function(b,c,d){return b.indexOf(c,d)!=-1};this.hasClass=function(c,b){return this.contains(c.className,b," ")};this.addClass=function(c,b){if(!this.hasClass(c,b)){c.className=(c.className+" "+b).replace(/\s{2,}/g," ").replace(/^\s+|\s+$/g,"")}};this.removeClass=function(c,b){c.className=c.className.replace(new RegExp("(^|\\s)"+b+"(?:\\s|$)"),"$1");c.className.replace(/\s{2,}/g," ").replace(/^\s+|\s+$/g,"")};this.refresh=function(){this.links=document.getElementById(this.defaults.tabsId).getElementsByTagName("div");this.tabs=this.getTabs();this.defaults.active=(this.parseurl(this.defaults.id))?this.parseurl(this.defaults.id):this.defaults.active;if(this.defaults.persist&&this.readCookie(this.defaults.id)){this.defaults.active=this.readCookie(this.defaults.id)}this.activebackup=this.defaults.active;this.show(this.defaults.active);var b=this;for(var c=0;c<this.links.length;c++){if(this.links[c].customindex){continue}this.links[c].customindex=c+1;this.links[c].onclick=function(){if(b.timer1){clearTimeout(b.timer1)}if(b.timer2){clearTimeout(b.timer2)}b.show(this.customindex);if(b.defaults.persist){b.createCookie(b.defaults.id,this.customindex,0)}if(b.defaults.wait){b.timer2=setTimeout(function(){b.rotate(b.defaults.interval)},b.defaults.wait*1000)}return false}}if(this.defaults.interval){this.rotate(this.defaults.interval)}};if(this.getTabs().length>0){this.refresh()}}de.edirom.server.main.Toolbar=Class.create({initialize:function(){this.items=new Array()},addItem:function(a){this.items.push(a)},getId:function(){return"objectToolbar"},hide:function(){$("objectToolbar").style.display="none"}});de.edirom.server.main.ToolbarItem=Class.create({initialize:function(a){this.toolbar=a;this.active=false;this.id="toolbarItem_"+(new Date).getTime();while($(this.id)!=null){this.id="toolbarItem_"+(new Date).getTime()}$(a.getId()).insert({bottom:'<div id="'+this.id+'"></div>'})},setActive:function(a){this.active=a},setVisible:function(a){if(a){$(this.id).show()}else{$(this.id).hide()}},getId:function(){return this.id}});de.edirom.server.main.ToolbarGroup=Class.create({initialize:function(a){this.id="toolbarGroup_"+(new Date).getTime();while($(this.id)!=null){this.id="toolbarGroup_"+(new Date).getTime()}$(a.getId()).insert({bottom:'<div id="'+this.id+'"></div>'});this.items=new Array()},setVisible:function(a){if(a){$(this.id).show()}else{$(this.id).hide()}},getId:function(){return this.id}});de.edirom.server.main.toolbar={};de.edirom.server.main.toolbar.Save=Class.create(de.edirom.server.main.ToolbarItem,{initialize:function($super,a,b){$super(a);this.action=b;this.active=false;$(a.getId()).insert({bottom:'<div title="Speichern" id="toolbar_save" class="saveButton inactive"> </div><span id="toolbar_save_dirty" class="" style="display:none;"/>'});Event.observe($("toolbar_save"),"click",this.doSave.bind(this))},doSave:function(a){if(this.active){this.action.doSave()}},setActive:function($super,a){$super();this.active=a;if(a){$("toolbar_save").removeClassName("inactive");$("toolbar_save").addClassName("active");$("toolbar_save_dirty").addClassName("dirty")}else{$("toolbar_save").removeClassName("active");$("toolbar_save").addClassName("inactive");$("toolbar_save_dirty").removeClassName("dirty")}}});de.edirom.server.main.toolbar.Undo=Class.create(de.edirom.server.main.ToolbarItem,{initialize:function($super,a,b){$super(a);this.action=b;this.active=false;$(a.getId()).insert({bottom:'<div title="Zurücksetzen" id="toolbar_undo" class="undoButton inactive"> </div>'});Event.observe($("toolbar_undo"),"click",this.doUndo.bind(this))},doUndo:function(a){if(this.active){this.action.doUndo()}},setActive:function($super,a){$super();this.active=a;if(a){$("toolbar_undo").removeClassName("inactive");$("toolbar_undo").addClassName("active")}else{$("toolbar_undo").removeClassName("active");$("toolbar_undo").addClassName("inactive")}}});de.edirom.server.main.toolbar.Redo=Class.create(de.edirom.server.main.ToolbarItem,{initialize:function($super,a,b){$super(a);this.action=b;this.active=false;$(a.getId()).insert({bottom:'<div title="Wiederherstellen" id="toolbar_redo" class="redoButton inactive"> </div>'});Event.observe($("toolbar_redo"),"click",this.doRedo.bind(this))},doRedo:function(a){if(this.active){this.action.doRedo()}},setActive:function($super,a){$super();this.active=a;if(a){$("toolbar_redo").removeClassName("inactive");$("toolbar_redo").addClassName("active")}else{$("toolbar_redo").removeClassName("active");$("toolbar_redo").addClassName("inactive")}}});de.edirom.server.main.toolbar.dropDown=Class.create(de.edirom.server.main.ToolbarItem,{initialize:function($super,b,d,c,a){$super(b);this.action=d;this.active=false;this.dropDown=c;this.controller=a;this.commandString="";$(b.getId()).insert({bottom:'<div title="DropDown" id="toolbar_dropdown" class="dropDownButton inactive">                <div id="menu">                </div>            </div>'}),Event.observe($("toolbar_dropdown"),"mousedown",function(h){if(!this.dropDown.checkVisibility()){this.doDropDown()}else{var g=h.findElement(".toolbar_dropdown_command");if(g){var f=g.readAttribute("id")}var e=f.split("_");this.createUndo(e[1])}}.bindAsEventListener(this))},doDropDown:function(a){if(this.active){this.commandString=this.action.doDropDown();$("menu").remove();$("toolbar_dropdown").insert('<div id="menu">'+this.commandString+"</div>");this.dropDown.menuOpen("menu")}},createUndo:function(a){this.controller.createMultiUndo(a)},setActive:function($super,a){$super();this.active=a;if(a){$("toolbar_dropdown").removeClassName("inactive");$("toolbar_dropdown").addClassName("active")}else{$("toolbar_dropdown").removeClassName("active");$("toolbar_dropdown").addClassName("inactive")}}});de.edirom.server.main.toolbar.View=Class.create(de.edirom.server.main.ToolbarItem,{initialize:function($super,a){$super(a);$(a.getId()).insert({bottom:'<div id="view">Info</div>'});Event.observe($("view"),"click",this.changeView.bind(this))},changeView:function(a){}});de.edirom.server.main.UndoCommand=Class.create({type:"UndoCommand",initialize:function(a,b){this.list=a;this.pointer=b;this.undone=true},redo:function(){this.list[this.pointer].undo()},undo:function(){this.list[this.pointer].redo()},getXQueryUpdate:function(){return this.list[this.pointer].getXQueryUpdate()},setCommandUndone:function(a){this.list[this.pointer].setUndone(a)},getType:function(){return this.type},getUndone:function(){return this.undone},setUndone:function(a){this.undone=a}});de.edirom.areArraysEqual=function(d,c){if(typeof(d)!=typeof(c)){return false}if(!d[0]||!c[0]){return false}if(d.length!=c.length){return false}var b=d.length;for(var a=0;a<b;a++){if(d[a]!==c[a]){return false}}return true};de.edirom.closeWindow=function(){window.status="edirom:de.edirom.server:closeWindow"};de.edirom.checkChanged=function(a){if(!$(a)||!$("old_"+a)){return false}if($(a).value==$("old_"+a).value){return false}return true};de.edirom.getPositionOnPage=function(c){var b=c.offsetLeft;var a=c.offsetTop;if(c.offsetParent){while(c=c.offsetParent){b+=c.offsetLeft;a+=c.offsetTop}}return[b,a]};de.edirom.changeActiveTab=function(a,e){var c=document.getElementById(a).parentNode.childNodes;for(var b=0;b<c.length;b++){if(typeof c[b].removeClassName!="undefined"){c[b].removeClassName("activeTab")}}var d=document.getElementById("ediromDetail").childNodes;for(var b=0;b<d.length;b++){if(d[b].className&&d[b].className.indexOf("ediromDetailContent")!=-1){d[b].style.display="none"}}document.getElementById(e).style.display="block";document.getElementById(a).addClassName("activeTab")};de.edirom.ImportListener=function(script,func){var self=this;var scriptLoaded=false;var unique="scriptLoaded_"+(new Date()).getTime();this.scriptLoaded=function(){if(scriptLoaded){return}scriptLoaded=true;Ajile.RemoveImportListener(eval(unique));func()};window[unique]=self.scriptLoaded;Ajile.AddImportListener(eval(unique))};de.edirom.WindowResize=function(){var c=this;var f;var b;var e=new Array();window.onresize=d;f=a();b=g();function d(){if(f!=a()||b!=g()){f=a();b=g();for(var h=0;h<e.length;h++){e[h]()}}}function a(){if(window.innerWidth){return window.innerWidth}else{if(document.body&&document.body.offsetWidth){return document.body.offsetWidth}}return 0}function g(){if(window.innerHeight){return window.innerHeight}else{if(document.body&&document.body.offsetHeight){return document.body.offsetHeight}}return 0}this.addListener=function(h){if(e.indexOf(h)==-1){e.push(h)}};this.removeListener=function(h){if(e.indexOf(h)!=-1){e=e.without(h)}}};var windowResize=new de.edirom.WindowResize();Object.extend(Event,{wheel:function(a){var b=0;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera){b=-b}}else{if(a.detail){b=-a.detail/3}}return Math.round(b)}});function checkContentNotEmpty(a){if(a.value.strip().length==0){return false}else{return true}}function requestFocus(a){$(a).focus();$(a).select()}var popup;function openPopup(c,a,d,b){popup=new Popup(c,a,d,b);popup.showPopup()}function Popup(_message,_okButton,_cancelButton,_okFunc){var self=this;var width=350;var height=130;var message=_message;var okButton=_okButton;var cancelButton=_cancelButton;var okFunc=_okFunc+";";this.showPopup=function(){Event.observe(window,"keyup",handleKeys);if(!$("popup_background")){var popup_background=document.createElement("div");popup_background.id="popup_background";popup_background.style.position="fixed";popup_background.style.top="0px";popup_background.style.left="0px";popup_background.style.bottom="0px";popup_background.style.right="0px";popup_background.style.backgroundColor="#000000";popup_background.style.opacity="0.5";popup_background.style.zIndex="9000";document.getElementsByTagName("body")[0].appendChild(popup_background)}if(!$("popup")){var popup=document.createElement("div");popup.id="popup";popup.style.position="fixed";popup.style.width=width+"px";popup.style.height=height+"px";popup.style.top="50%";popup.style.left="50%";popup.style.marginLeft="-"+Math.round(width/2)+"px";popup.style.marginTop="-"+Math.round(height/2)+"px";popup.style.backgroundColor="#eeeeee";popup.style.zIndex="9001";var text='<div style="position:absolute; top:20px; left:20px; right:20px; bottom:50px;">'+message+"</div>";var buttons='<div style="position:absolute; bottom:10px; right:10px;" class="saveBox"><span class="saveBoxButton" onclick="popup.closePopup();">'+cancelButton+'</span><span class="saveBoxButton" onclick="popup.closePopup();'+okFunc+'">'+okButton+"</span></div>";popup.innerHTML=text+buttons;document.getElementsByTagName("body")[0].appendChild(popup)}};this.closePopup=function(){Event.stopObserving(window,"keyup",handleKeys);var parent=$("popup").parentNode;parent.removeChild($("popup"));parent.removeChild($("popup_background"))};var handleKeys=function(e){if(e.keyCode==Event.KEY_RETURN){self.closePopup();eval(okFunc)}if(e.keyCode==Event.KEY_ESC){self.closePopup()}}}function getBoxModelWidth(a,c){var b=a.getWidth();if(c=="padding"||c=="content"||c=="inner"){b-=getCssIntAttr(a,"border-left-width")+getCssIntAttr(a,"border-right-width");if(c=="content"||c=="inner"){b-=getCssIntAttr(a,"padding-left")+getCssIntAttr(a,"padding-right")}}else{if(c=="margin"||c=="outer"){b+=getCssIntAttr(a,"margin-left")+getCssIntAttr(a,"margin-right")}}return b}function getBoxModelHeight(b,c){var a=b.getHeight();if(c=="padding"||c=="content"||c=="inner"){a-=getCssIntAttr(b,"border-top-width")+getCssIntAttr(b,"border-bottom-width");if(c=="content"||c=="inner"){a-=getCssIntAttr(b,"padding-top")+getCssIntAttr(b,"padding-bottom")}}else{if(c=="margin"||c=="outer"){a+=getCssIntAttr(b,"margin-top")+getCssIntAttr(b,"margin-bottom")}}return a}function getCssIntAttr(b,a){if(isNaN(parseInt(b.getStyle(a)))){return 0}else{return parseInt(b.getStyle(a))}}function firstDisplayed(a,c){var d=a.select(c);for(var b=0;b<d.length;b++){if(d[b].getStyle("display")!="none"){return d[b]}}return null}function displayedExists(a,b){if(firstDisplayed(a,b)!=null){return true}else{return false}}function validateXQueryDate(a){arr=a.split("-");if(arr.length!=3||arr[0].length>4||arr[1].length>2||arr[2].length>2){return false}if(parseInt(arr[0])==NaN||parseInt(arr[1])==NaN||parseInt(arr[2])==NaN){return false}monthMaxDays=new Array(31,30,31,30,31,30,31,31,30,31,30,31);if(arr[0]<1||arr[1]<1||arr[1]>12||arr[2]<1||arr[2]>monthMaxDays[parseInt(arr[1])-1]){return false}return formatNumberString("0000-11-22",arr)}function formatNumberString(b,a){var d=b;var k;var g;var l;var h;for(var f=0;f<=9;f++){g="";if(f<a.length){g+=a[f]}l=g.length-1;for(var e=b.length-1;e>=0;e--){k=b.charAt(e);if(parseInt(k)==f){if(l>=0){h=g.charAt(l);l--}else{h="0"}d=replaceCharInString(d,e,h)}}}return d}function replaceCharInString(d,c,a){var b="";if(c>0){b+=d.substring(0,c)}b+=a;if(c<d.length-1){b+=d.substring(c+1,d.length)}return b}Object.extend(Event,{wheel:function(a){var b=0;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera){b=-b}}else{if(a.detail){b=-a.detail/3}}return b}});de.edirom.server.main.View=Class.create({initialize:function(a,b){this.module=a;this.active=false;this.id="view_"+(new Date).getTime();while($(this.id)!=null){this.id="view_"+(new Date).getTime()}$("viewSwitch").insert({bottom:'<div class="viewSwitchButton" id="switch_'+this.id+'">'+b+"</div>"});$("ediromObject").insert({bottom:'<div id="'+this.id+'" />'});$(this.id).hide();this.tabBar=new de.edirom.server.main.TabBar();this.contents=new Array();Event.observe($("switch_"+this.id),"click",this.switchClicked.bind(this))},switchClicked:function(a){if(!this.active){this.module.setActiveView(this)}},addContent:function(a){this.contents.push(a)},addContentWithTab:function(b,a){this.addContent(b);this.tabBar.addTab(new de.edirom.server.main.Tab(this.tabBar,a,b))},setActive:function(a){this.active=a;if(a){$("switch_"+this.id).addClassName("active");$(this.id).show()}else{$("switch_"+this.id).removeClassName("active");$(this.id).hide()}},isActive:function(){return this.active},getModule:function(){return this.module},getActiveContentKey:function(){var b;for(var a=0;a<this.contents.size();a++){if(this.contents[a].isActive()){b=this.contents[a]}}if(typeof(b)!="undefined"){return b.getKey()}return""}});de.edirom.server.main.VisibilityChangeRequestedListener=Class.create({initialize:function(a){this.visibilityChangeRequested=a}});de.edirom.server.main.VisibilityChangedListener=Class.create({initialize:function(a){this.visibilityChanged=a}});var buttonsEnabled=true;function createNewObject(a){buttonsEnabled=false;window.location.href=a}function getSelectedOption(){return document.getElementById("objectTypes").value}function dataListener(a){}if(typeof(console)=="undefined"||typeof(console.log)=="undefined"){console={};console.log=function(a){alert(a)}}de.edirom.server.main.getPositionOnPage=function(c){var b=c.offsetLeft;var a=c.offsetTop;if(c.offsetParent){while(c=c.offsetParent){b+=c.offsetLeft;a+=c.offsetTop}}return[b,a]};de.edirom.server.main.registerCometListener=function(c,b,a){new Ajax.Request("/comet/",{method:"get",parameters:{lastEvent:a},onSuccess:function(g){var f=g.responseText;f=f.strip();var e=f.split(":");var d=-1;if(e[0]=="lastEvent"){d=e[1];f=f.substring("lastEvent:".length+e[1].length+":".length)}de.edirom.server.main.registerCometListener(c,b,(d==-1?null:d));de.edirom.server.main.logger.debug("new comet registered");c(f);de.edirom.server.main.logger.debug("comet success function finished")},onFailure:function(d){b()}})};de.edirom.server.main.Logger=function(a,c){this.TRACE=0;this.DEBUG=1;this.INFO=2;this.WARN=3;this.ERROR=4;this.FATAL=5;this.module=a;this.level=c?c:this.TRACE;var b=function(e,d){new Ajax.Request("/logger/",{method:"get",parameters:{level:e,module:this.module,message:d}})};this.trace=function(d){if(this.level<=this.TRACE){b("trace",d)}};this.debug=function(d){if(this.level<=this.DEBUG){b("debug",d)}};this.info=function(d){if(this.level<=this.INFO){b("info",d)}};this.warn=function(d){if(this.level<=this.WARN){b("warn",d)}};this.error=function(d){if(this.level<=this.ERROR){b("error",d)}};this.fatal=function(d){if(this.level<=this.FATAL){b("fatal",d)}}};de.edirom.server.main.logger=new de.edirom.server.main.Logger("main");de.edirom.server.main.deleteItem=function(b,a){a.firstButton="Nein";a.secondButton="Ja";a.firstFunc=a.cancelFunc;a.secondFunc=a.deleteFunc;(new de.edirom.server.main.Popup(b,a)).showPopup()};de.edirom.server.main.Popup=function(_message,_options,_title,_detailedMessage){var self=this;var message=_message;var options=_options;var title=_title;var detailedMessage=_detailedMessage;var firstButton=options.firstButton?options.firstButton:"Abbrechen";var firstFunc=options.firstFunc?options.firstFunc:";";var secondButton=options.secondButton?options.secondButton:"Bestätigen";var secondFunc=options.secondFunc?options.secondFunc:";";var firstButtonVisible=options.firstButtonVisible?options.firstButtonVisible:"true";var secondButtonVisible=options.secondButtonVisible?options.secondButtonVisible:"true";this.showPopup=function(){if(!$("popup_background")){var popup_background=document.createElement("div");popup_background.id="popup_background";document.getElementsByTagName("body")[0].appendChild(popup_background)}if(!$("popup")){var popup=document.createElement("div");popup.id="popup";var header=(typeof(title)!="undefined")?"<h1>"+title+"</h1>":"<h1>Hinweis</h1>";var text='<div id="popupMessage">'+message+"</div>";var details=(typeof(detailedMessage)!="undefined")?'<div id="popupDetails">'+detailedMessage+"</div>":"";var buttons='<div id="popupButtons" class="saveBox"><span id="Popup_firstButton" class="saveBoxButton">'+firstButton+'</span><span id="Popup_secondButton" class="saveBoxButton">'+secondButton+"</span></div>";popup.innerHTML=header+text+details+buttons;document.getElementsByTagName("body")[0].appendChild(popup)}if(firstButtonVisible=="true"){$("Popup_firstButton").show()}else{$("Popup_firstButton").hide()}if(secondButtonVisible=="true"){$("Popup_secondButton").show()}else{$("Popup_secondButton").hide()}Event.observe(window,"keyup",handleKeys);Event.observe($("Popup_firstButton"),"click",firstButtonClick);Event.observe($("Popup_secondButton"),"click",secondButtonClick)};var closePopup=function(){Event.stopObserving(window,"keyup",handleKeys);Event.stopObserving($("Popup_firstButton"),"click",firstButtonClick);Event.stopObserving($("Popup_secondButton"),"click",secondButtonClick);var parent=$("popup").parentNode;parent.removeChild($("popup"));parent.removeChild($("popup_background"))};var handleKeys=function(e){if(e.keyCode==Event.KEY_RETURN){secondButtonClick()}if(e.keyCode==Event.KEY_ESC){firstButtonClick()}};var firstButtonClick=function(){closePopup();if(typeof(firstFunc)=="function"){firstFunc()}else{eval(firstFunc)}};var secondButtonClick=function(){closePopup();if(typeof(secondFunc)=="function"){secondFunc()}else{eval(secondFunc)}};return self};if(Object.isUndefined(Proto)){var Proto={}}Proto.Menu=Class.create((function(){var c=Prototype.emptyFunction;var b=Prototype.Browser.IE;var a={selector:".contextmenu",className:"protoMenu",pageOffset:25,fade:false,zIndex:100,beforeShow:c,beforeHide:c,beforeSelect:c};var d=(function(f){f.setAttribute("oncontextmenu","");var e=typeof f.oncontextmenu=="function";f=null;return e})(document.createElement("div"));return{initialize:function(){this.options=Object.extend(Object.clone(a),arguments[0]||{});this.shim=new Element("iframe",{style:"position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none",src:"javascript:false;",frameborder:0});this.options.fade=this.options.fade&&!Object.isUndefined(Effect);this.container=new Element("div",{className:this.options.className,style:"display:none"}).observe("contextmenu",Event.stop).observe("click",this.onClick.bind(this));var e=new Element("ul");this.options.menuItems.each(function(f){e.insert(new Element("li",{className:f.separator?"separator":""}).insert(f.separator?"":Object.extend(new Element("a",{href:"#",title:f.name,className:(f.className||"")+(f.disabled?" disabled":" enabled")}),{_callback:f.callback}).update(f.name)))}.bind(this));$(document.body).insert(this.container.insert(e).observe("contextmenu",Event.stop));b&&$(document.body).insert(this.shim);document.observe("click",function(f){this.hide(f)}.bind(this));$$(this.options.selector).invoke("observe",d?"contextmenu":"click",function(f){if(!d&&!f.ctrlKey){return}this.show(f)}.bind(this))},show:function(k){k.stop();if(typeof window.contextmenu!="undefined"&&window.contextmenu!=null){window.contextmenu.hide(k)}window.contextmenu=this;this.options.beforeShow(k);var g=Event.pointer(k).x,l=Event.pointer(k).y,i=document.viewport.getDimensions(),j=document.viewport.getScrollOffsets(),f=this.container.getDimensions(),h={left:((g+f.width+this.options.pageOffset)>i.width?(i.width-f.width-this.options.pageOffset):g)+"px",top:((l-j.top+f.height)>i.height&&(l-j.top)>f.height?(l-f.height):l)+"px"};this.container.setStyle(h).setStyle({zIndex:this.options.zIndex});if(b){this.shim.setStyle(Object.extend(Object.extend(f,h),{zIndex:this.options.zIndex-1})).show()}this.options.fade?Effect.Appear(this.container,{duration:0.25}):this.container.show();this.event=k},hide:function(f){if(this.container.visible()){this.options.beforeHide(f);if(b){this.shim.hide()}this.container.hide();window.contextmenu=null}},onClick:function(g,f){if((f=g.findElement("li a"))&&f.descendantOf(this.container)){g.stop();if(f._callback&&!f.hasClassName("disabled")){this.options.beforeSelect(g,f);if(b){this.shim.hide()}this.container.hide();f._callback(this.event)}}}}})());